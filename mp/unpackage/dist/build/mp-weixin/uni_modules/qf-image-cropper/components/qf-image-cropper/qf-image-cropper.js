(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper"],{"0778":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){}));var a=function(){var t=this.$createElement;this._self._c},s=[]},"0fe8":function(t,e,i){"use strict";i.r(e);var a=i("d89b"),s=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=s.a},"267b":function(t,e,i){"use strict";i.r(e);var a=i("0778"),s=i("0fe8");for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n);i("dfb3");var o=i("828b"),h=i("de60"),r=Object(o["a"])(s["default"],a["b"],a["c"],!1,null,"65a803d4",null,!1,a["a"],void 0);"function"===typeof h["a"]&&Object(h["a"])(r),e["default"]=r.exports},a36c:function(t,e,i){},d89b:function(t,e,i){"use strict";(function(t){var a=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=a(i("7eb4")),n=a(i("ee10")),o=a(i("7ca3"));function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){(0,o.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var c={name:"qf-image-cropper",options:{styleIsolation:"isolated"},props:{src:{type:String,default:""},width:{type:Number,default:300},height:{type:Number,default:300},showBorder:{type:Boolean,default:!0},showGrid:{type:Boolean,default:!0},showAngle:{type:Boolean,default:!0},areaScale:{type:Number,default:.3},minScale:{type:Number,default:1},maxScale:{type:Number,default:5},checkRange:{type:Boolean,default:!0},backgroundColor:{type:String},bounce:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},reverseRotatable:{type:Boolean,default:!1},choosable:{type:Boolean,default:!0},gpu:{type:Boolean,default:!1},angleSize:{type:Number,default:20},angleBorderWidth:{type:Number,default:2},zIndex:{type:[Number,String]},radius:{type:Number,default:0},fileType:{type:String,default:"png"},delay:{type:Number,default:1e3}},emits:["crop"],data:function(){return{maskList:[{id:"crop-mask-block-1"},{id:"crop-mask-block-2"},{id:"crop-mask-block-3"},{id:"crop-mask-block-4"}],gridList:[{id:"crop-grid-1"},{id:"crop-grid-2"},{id:"crop-grid-3"},{id:"crop-grid-4"}],angleList:[{id:"crop-angle-1"},{id:"crop-angle-2"},{id:"crop-angle-3"},{id:"crop-angle-4"}],imgSrc:"",imgWidth:300,imgHeight:300,widthPercent:75,heightPercent:75,area:{},oldWidth:0,oldHeight:0,sys:t.getSystemInfoSync(),scaleWidth:0,scaleHeight:0,rotate:0,offsetX:0,offsetY:0,use2d:!1,canvansWidth:0,canvansHeight:0,originalImage:""}},computed:{initData:function(){return{timestamp:(new Date).getTime(),area:r(r({},this.area),{},{bounce:this.bounce,showBorder:this.showBorder,showGrid:this.showGrid,showAngle:this.showAngle,angleSize:this.angleSize,angleBorderWidth:this.angleBorderWidth,minScale:this.areaScale,widthPercent:this.widthPercent,heightPercent:this.heightPercent,radius:this.radius,checkRange:this.checkRange,zIndex:+this.zIndex||0}),sys:this.sys,img:{minScale:this.minScale,maxScale:this.maxScale,src:this.imgSrc,width:this.oldWidth,height:this.oldHeight,oldWidth:this.oldWidth,oldHeight:this.oldHeight,gpu:this.gpu}}},imgProps:function(){return{width:this.width,height:this.height,src:this.src}}},watch:{imgProps:{handler:function(t,e){this.imgWidth=Number(t.width)||300,this.imgHeight=Number(t.height)||300;var i=this.imgWidth,a=this.imgHeight,s=Math.max(i,a),n=1;s>1365&&(n=1365/s),this.canvansWidth=i*n,this.canvansHeight=a*n,this.use2d=!0,this.initArea();var o=t.src||this.imgSrc;o&&this.initImage(o,void 0===e)},immediate:!0}},methods:{dataChange:function(t){this.scaleWidth=t.width,this.scaleHeight=t.height,this.rotate=t.rotate,this.offsetX=t.x,this.offsetY=t.y},initArea:function(){this.sys.offsetBottom=t.upx2px(100)+this.sys.safeAreaInsets.bottom,this.sys.windowTop=0,this.sys.navigation=!0;var e=this.widthPercent,i=this.heightPercent;this.imgWidth>this.imgHeight?i=i*this.imgHeight/this.imgWidth:this.imgWidth<this.imgHeight&&(e=e*this.imgWidth/this.imgHeight);var a=this.sys.windowWidth>this.sys.windowHeight?this.sys.windowHeight:this.sys.windowWidth,s=a*e/100,n=a*i/100,o=(this.sys.windowWidth-s)/2,h=o+s,r=(this.sys.windowHeight+this.sys.windowTop-this.sys.offsetBottom-n)/2,c=this.sys.windowHeight+this.sys.windowTop-this.sys.offsetBottom-r;this.area={width:s,height:n,left:o,right:h,top:r,bottom:c},this.scaleWidth=s,this.scaleHeight=n},chooseImage:function(e){var i=this;t.chooseMedia?t.chooseMedia(r(r({},e),{},{count:1,mediaType:["image"],success:function(t){i.originalImage=t.tempFiles[0].tempFilePath,i.resetData(),i.initImage(t.tempFiles[0].tempFilePath)}})):t.chooseImage(r(r({},e),{},{count:1,success:function(t){i.originalImage=t.tempFiles[0].path,i.resetData(),i.initImage(t.tempFiles[0].path)}}))},resetData:function(){this.imgSrc="",this.rotate=0,this.offsetX=0,this.offsetY=0,this.initArea()},initImage:function(e,i){var a=this;t.getImageInfo({src:e,success:function(){var t=(0,n.default)(s.default.mark((function t(n){var o,h;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!i||a.src!==e){t.next=3;break}return t.next=3,new Promise((function(t){return setTimeout(t,50)}));case 3:a.imgSrc=n.path,o=n.width/n.height,h=a.area.width/a.area.height,o>1?o>=h?a.scaleWidth=a.scaleHeight/n.height*a.scaleWidth*(n.width/a.scaleWidth):a.scaleHeight=n.height*a.scaleWidth/n.width:o<=h?a.scaleHeight=a.scaleWidth/n.width*a.scaleHeight/(a.scaleHeight/n.height):a.scaleWidth=n.width*a.scaleHeight/n.height,a.oldWidth=+a.scaleWidth.toFixed(2),a.oldHeight=+a.scaleHeight.toFixed(2);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),fail:function(t){console.error(t)}})},drawClipImage:function(t,e,i,a){if(e>0){t.save(),t.beginPath();var s=this.canvansWidth,n=this.canvansHeight;s===n&&e>=s/2?t.arc(s/2,n/2,s/2,0,2*Math.PI):(s!==n&&(e=Math.min(s/2,n/2,e)),t.moveTo(e,0),t.arcTo(s,0,s,n,e),t.arcTo(s,n,0,n,e),t.arcTo(0,n,0,0,e),t.arcTo(0,0,s,0,e),t.closePath()),t.clip(),a&&a(!0),t.restore()}else a&&a(!1)},drawRotateImage:function(t,e,i){if(0!==e){var a=this.scaleWidth*i/2,s=this.scaleHeight*i/2;t.translate(a,s),t.rotate(e*Math.PI/180),t.translate(-a,-s)}},drawImage:function(t,e,i){var a=this,s=this.canvansWidth/this.area.width;this.backgroundColor&&(t.setFillStyle?t.setFillStyle(this.backgroundColor):t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.canvansWidth,this.canvansHeight)),this.drawClipImage(t,this.radius,s,(function(){a.drawRotateImage(t,a.rotate,s);var i=a.rotate/90;t.drawImage(e,[a.offsetX-a.area.left,a.offsetY-a.area.top,-(a.offsetX-a.area.left),-(a.offsetY-a.area.top)][i]*s,[a.offsetY-a.area.top,-(a.offsetX-a.area.left),-(a.offsetY-a.area.top),a.offsetX-a.area.left][i]*s,a.scaleWidth*s,a.scaleHeight*s)}))},draw2DImage:function(e,i,a,s){var n=this;if(e){var o=e.createImage();o.onload=function(){n.drawImage(i,o),s&&setTimeout(s,n.delay)},o.onerror=function(e){console.error(e),t.hideLoading()},o.src=a}else this.drawImage(i,a),setTimeout((function(){i.draw(!1,s)}),200)},canvasToTempFilePath:function(e,i){var a=this;t.canvasToTempFilePath({canvas:e,canvasId:i,x:0,y:0,width:this.canvansWidth,height:this.canvansHeight,destWidth:this.imgWidth,destHeight:this.imgHeight,fileType:this.fileType,success:function(t){a.handleImage(t.tempFilePath)},fail:function(e){t.hideLoading(),t.showToast({title:"裁剪失败，生成图片异常！",icon:"none"})}},this)},cropClick:function(){var e=this;if(t.showLoading({title:"裁剪中...",mask:!0}),!this.use2d){var i=t.createCanvasContext("imgCanvas",this);return i.clearRect(0,0,this.canvansWidth,this.canvansHeight),void this.draw2DImage(null,i,this.imgSrc,(function(){e.canvasToTempFilePath(null,"imgCanvas")}))}var a=t.createSelectorQuery().in(this);a.select("#imgCanvas").fields({node:!0,size:!0}).exec((function(i){var a=i[0].node,s=t.getSystemInfoSync().pixelRatio;a.width=i[0].width*s,a.height=i[0].height*s;var n=a.getContext("2d");n.scale(s,s),n.clearRect(0,0,e.canvansWidth,e.canvansHeight),e.draw2DImage(a,n,e.imgSrc,(function(){e.canvasToTempFilePath(a)}))}))},handleImage:function(e){t.hideLoading(),this.$emit("crop",{tempFilePath:e,originalImage:this.originalImage})}}};e.default=c}).call(this,i("df3c")["default"])},de60:function(t,e,i){"use strict";e["a"]=function(t){t.options.wxsCallMethods||(t.options.wxsCallMethods=[]),t.options.wxsCallMethods.push("dataChange")}},dfb3:function(t,e,i){"use strict";var a=i("a36c"),s=i.n(a);s.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper-create-component',
    {
        'uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('df3c')['createComponent'](__webpack_require__("267b"))
        })
    },
    [['uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper-create-component']]
]);
